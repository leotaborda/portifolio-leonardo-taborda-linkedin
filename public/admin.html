<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Administração de Mensagens</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="shortcut icon" href="images/icons/admin-page-icon.png" />
    <style>
      /* === CSS CUSTOM PROPERTIES === */
      :root {
        /* Colors - Modern Professional Palette */
        --primary-50: #f0f9ff;
        --primary-100: #e0f2fe;
        --primary-500: #0ea5e9;
        --primary-600: #0284c7;
        --primary-700: #0369a1;
        --primary-900: #0c4a6e;
        
        --gray-50: #f8fafc;
        --gray-100: #f1f5f9;
        --gray-200: #e2e8f0;
        --gray-300: #cbd5e1;
        --gray-400: #94a3b8;
        --gray-500: #64748b;
        --gray-600: #475569;
        --gray-700: #334155;
        --gray-800: #1e293b;
        --gray-900: #0f172a;
        
        --red-50: #fef2f2;
        --red-500: #ef4444;
        --red-600: #dc2626;
        --red-700: #b91c1c;
        
        --green-50: #f0fdf4;
        --green-500: #22c55e;
        --green-600: #16a34a;
        
        --amber-50: #fffbeb;
        --amber-500: #f59e0b;
        
        /* Spacing Scale */
        --space-1: 0.25rem;
        --space-2: 0.5rem;
        --space-3: 0.75rem;
        --space-4: 1rem;
        --space-5: 1.25rem;
        --space-6: 1.5rem;
        --space-8: 2rem;
        --space-12: 3rem;
        --space-16: 4rem;
        
        /* Typography */
        --text-xs: 0.75rem;
        --text-sm: 0.875rem;
        --text-base: 1rem;
        --text-lg: 1.125rem;
        --text-xl: 1.25rem;
        --text-2xl: 1.5rem;
        --text-3xl: 1.875rem;
        
        /* Border Radius */
        --radius-sm: 0.375rem;
        --radius-md: 0.5rem;
        --radius-lg: 0.75rem;
        --radius-xl: 1rem;
        
        /* Shadows */
        --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        
        /* Transitions */
        --transition-fast: 150ms ease;
        --transition-base: 300ms ease;
        --transition-slow: 500ms ease;
      }

      /* === RESET & BASE === */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      html {
        font-size: 16px;
        scroll-behavior: smooth;
      }

      body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, var(--gray-50) 0%, var(--primary-50) 100%);
        color: var(--gray-800);
        line-height: 1.6;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        padding: var(--space-6);
        gap: var(--space-8);
        font-feature-settings: 'kern' 1, 'liga' 1;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      /* === NAVBAR === */
      .navbar {
        background: linear-gradient(135deg, var(--gray-900) 0%, var(--gray-800) 100%);
        color: white;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--space-6) var(--space-8);
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-lg);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        position: relative;
        overflow: hidden;
      }

      .navbar::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      }

      .navbar .welcome {
        font-size: var(--text-xl);
        font-weight: 600;
        letter-spacing: -0.025em;
        color: var(--gray-100);
      }

      /* === MODERN LOGOUT BUTTON === */
      .Btn-logout {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-2);
        width: auto;
        height: 44px;
        padding: 0 var(--space-4);
        border: none;
        border-radius: var(--radius-lg);
        cursor: pointer;
        position: relative;
        overflow: hidden;
        transition: all var(--transition-base);
        background: linear-gradient(135deg, var(--red-600), var(--red-700));
        color: white;
        font-weight: 500;
        font-size: var(--text-sm);
        box-shadow: var(--shadow-sm);
        min-width: 44px;
      }

      .Btn-logout:hover {
        background: linear-gradient(135deg, var(--red-500), var(--red-600));
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
      }

      .Btn-logout:active {
        transform: translateY(0);
        box-shadow: var(--shadow-sm);
      }

      .sign {
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all var(--transition-base);
      }

      .sign svg {
        width: 18px;
        height: 18px;
        fill: currentColor;
      }

      .text {
        opacity: 0;
        width: 0;
        overflow: hidden;
        transition: all var(--transition-base);
        white-space: nowrap;
        font-weight: 500;
      }

      .Btn-logout:hover .text {
        opacity: 1;
        width: auto;
        margin-left: var(--space-2);
      }

      /* === MESSAGES HEADER === */
      #messages-header {
        display: flex;
        gap: var(--space-4);
        align-items: center;
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        padding: var(--space-6);
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-lg);
        border: 1px solid var(--gray-200);
      }

      #searchBar {
        flex: 1;
        padding: var(--space-3) var(--space-4);
        font-size: var(--text-base);
        border: 2px solid var(--gray-200);
        border-radius: var(--radius-lg);
        background: var(--gray-50);
        transition: all var(--transition-fast);
        font-family: inherit;
        color: var(--gray-700);
      }

      #searchBar:focus {
        outline: none;
        border-color: var(--primary-500);
        background: white;
        box-shadow: 0 0 0 3px var(--primary-100);
      }

      #searchBar::placeholder {
        color: var(--gray-400);
      }

      /* === MODERN BUTTONS === */
      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-2);
        padding: var(--space-3) var(--space-5);
        font-size: var(--text-sm);
        font-weight: 500;
        border: none;
        border-radius: var(--radius-lg);
        cursor: pointer;
        transition: all var(--transition-fast);
        text-decoration: none;
        font-family: inherit;
        line-height: 1;
        position: relative;
        overflow: hidden;
        min-height: 40px;
      }

      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none !important;
      }

      .btn-primary {
        background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
        color: white;
        box-shadow: var(--shadow-sm);
      }

      .btn-primary:hover:not(:disabled) {
        background: linear-gradient(135deg, var(--primary-600), var(--primary-700));
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
      }

      .btn-danger {
        background: linear-gradient(135deg, var(--red-500), var(--red-600));
        color: white;
        box-shadow: var(--shadow-sm);
      }

      .btn-danger:hover:not(:disabled) {
        background: linear-gradient(135deg, var(--red-600), var(--red-700));
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
      }

      #selectMessagesBtn { @extend .btn, .btn-primary; }
      #deleteSelectedBtn { @extend .btn, .btn-danger; }

      /* === MESSAGES CONTAINER === */
      #messages-container {
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-lg);
        padding: var(--space-8);
        border: 1px solid var(--gray-200);
        position: relative;
      }

      #messages-container h2 {
        font-size: var(--text-2xl);
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: var(--space-8);
        text-align: center;
        letter-spacing: -0.025em;
        position: relative;
      }

      #messages-container h2::after {
        content: '';
        position: absolute;
        bottom: -var(--space-3);
        left: 50%;
        transform: translateX(-50%);
        width: 60px;
        height: 3px;
        background: linear-gradient(90deg, var(--primary-500), var(--primary-600));
        border-radius: 2px;
      }

      /* === MESSAGE CARDS === */
      .message {
        background: var(--gray-50);
        border: 1px solid var(--gray-200);
        border-radius: var(--radius-xl);
        padding: var(--space-6);
        margin-bottom: var(--space-6);
        position: relative;
        transition: all var(--transition-base);
        display: flex;
        flex-direction: column;
        gap: var(--space-4);
        overflow: hidden;
      }

      .message::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--primary-500), var(--primary-600));
        opacity: 0;
        transition: opacity var(--transition-base);
      }

      .message:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-xl);
        border-color: var(--primary-200);
        background: white;
      }

      .message:hover::before {
        opacity: 1;
      }

      .message-title {
        font-weight: 600;
        font-size: var(--text-lg);
        color: var(--gray-900);
        text-align: center;
        letter-spacing: -0.025em;
        margin-bottom: var(--space-2);
      }

      .message-content {
        background: white;
        padding: var(--space-5);
        border-radius: var(--radius-lg);
        border: 1px solid var(--gray-200);
        font-size: var(--text-sm);
        line-height: 1.6;
        color: var(--gray-700);
      }

      .message-content p {
        margin-bottom: var(--space-3);
      }

      .message-content p:last-of-type {
        margin-bottom: var(--space-4);
      }

      .message-content strong {
        color: var(--gray-900);
        font-weight: 600;
      }

      .message-content a {
        display: inline-flex;
        align-items: center;
        gap: var(--space-2);
        color: var(--primary-600);
        text-decoration: none;
        font-weight: 500;
        padding: var(--space-2) var(--space-4);
        border-radius: var(--radius-md);
        background: var(--primary-50);
        border: 1px solid var(--primary-200);
        transition: all var(--transition-fast);
        font-size: var(--text-sm);
      }

      .message-content a:hover {
        background: var(--primary-100);
        border-color: var(--primary-300);
        transform: translateY(-1px);
      }

      /* === DELETE BUTTON === */
      .delete-btn {
        position: absolute;
        top: var(--space-4);
        right: var(--space-4);
        width: 36px;
        height: 36px;
        background: var(--red-50);
        border: 1px solid var(--red-200);
        border-radius: var(--radius-lg);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all var(--transition-fast);
        font-size: var(--text-sm);
        color: var(--red-600);
      }

      .delete-btn:hover {
        background: var(--red-500);
        border-color: var(--red-500);
        color: white;
        transform: scale(1.05);
      }

      /* === MODERN CHECKBOX === */
      .styled-checkbox {
        appearance: none;
        width: 20px;
        height: 20px;
        border: 2px solid var(--gray-300);
        border-radius: var(--radius-sm);
        background: white;
        cursor: pointer;
        position: relative;
        transition: all var(--transition-fast);
        display: none;
        align-self: flex-start;
        margin-top: var(--space-1);
      }

      .styled-checkbox:checked {
        background: var(--primary-500);
        border-color: var(--primary-500);
      }

      .styled-checkbox:checked::after {
        content: '✓';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 12px;
        font-weight: 600;
      }

      .styled-checkbox:hover {
        border-color: var(--primary-500);
        box-shadow: 0 0 0 3px var(--primary-100);
      }

      .styled-checkbox:focus {
        outline: none;
        box-shadow: 0 0 0 3px var(--primary-100);
      }

      #messages-container.select-mode .styled-checkbox {
        display: block;
      }

      /* === MODALS === */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(8px);
        justify-content: center;
        align-items: center;
        padding: var(--space-4);
      }

      .modal-content {
        background: white;
        padding: var(--space-8);
        width: 100%;
        max-width: 480px;
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-xl);
        text-align: center;
        position: relative;
        border: 1px solid var(--gray-200);
        animation: modalSlideIn 0.3s ease-out;
      }

      @keyframes modalSlideIn {
        from {
          opacity: 0;
          transform: scale(0.95) translateY(-20px);
        }
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }

      .modal-header {
        margin-bottom: var(--space-6);
      }

      .icon-warning {
        font-size: 48px;
        margin-bottom: var(--space-4);
        display: block;
      }

      .modal-header h2 {
        font-size: var(--text-xl);
        font-weight: 600;
        color: var(--gray-900);
        margin: 0;
        letter-spacing: -0.025em;
      }

      .modal-body {
        font-size: var(--text-base);
        color: var(--gray-600);
        margin-bottom: var(--space-8);
        line-height: 1.6;
      }

      .modal-footer {
        display: flex;
        gap: var(--space-3);
        justify-content: center;
      }

      .modal-button {
        @extend .btn;
        min-width: 120px;
      }

      .confirm-btn {
        @extend .btn-danger;
      }

      .cancel-btn {
        background: var(--gray-100);
        color: var(--gray-700);
        border: 1px solid var(--gray-300);
      }

      .cancel-btn:hover {
        background: var(--gray-200);
        border-color: var(--gray-400);
        transform: translateY(-1px);
      }

      .close-btn {
        position: absolute;
        top: var(--space-4);
        right: var(--space-4);
        width: 32px;
        height: 32px;
        border: none;
        background: var(--gray-100);
        border-radius: var(--radius-md);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: var(--text-lg);
        color: var(--gray-500);
        transition: all var(--transition-fast);
      }

      .close-btn:hover {
        background: var(--gray-200);
        color: var(--gray-700);
      }

      /* === RESPONSIVE DESIGN === */
      @media (max-width: 768px) {
        body {
          padding: var(--space-4);
          gap: var(--space-6);
        }

        .navbar {
          flex-direction: column;
          gap: var(--space-4);
          padding: var(--space-5);
        }

        .navbar .welcome {
          font-size: var(--text-lg);
          text-align: center;
        }

        .Btn-logout {
          width: 100%;
          justify-content: center;
        }

        .Btn-logout .text {
          opacity: 1;
          width: auto;
          margin-left: var(--space-2);
        }

        #messages-header {
          flex-direction: column;
          gap: var(--space-4);
          padding: var(--space-5);
        }

        #searchBar {
          width: 100%;
        }

        .btn {
          width: 100%;
          justify-content: center;
        }

        #messages-container {
          padding: var(--space-5);
        }

        #messages-container h2 {
          font-size: var(--text-xl);
          margin-bottom: var(--space-6);
        }

        .message {
          padding: var(--space-5);
          margin-bottom: var(--space-5);
        }

        .message-title {
          font-size: var(--text-base);
        }

        .message-content {
          padding: var(--space-4);
        }

        .delete-btn {
          width: 32px;
          height: 32px;
          top: var(--space-3);
          right: var(--space-3);
        }

        .modal-content {
          padding: var(--space-6);
          margin: var(--space-4);
        }

        .modal-footer {
          flex-direction: column;
        }

        .modal-button {
          width: 100%;
        }
      }

      @media (max-width: 480px) {
        body {
          padding: var(--space-3);
        }

        .navbar {
          padding: var(--space-4);
        }

        #messages-header,
        #messages-container {
          padding: var(--space-4);
        }

        .message {
          padding: var(--space-4);
        }

        .message-content {
          padding: var(--space-3);
          font-size: var(--text-xs);
        }
      }

      /* === ACCESSIBILITY === */
      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }

      /* === FOCUS STYLES === */
      .btn:focus-visible,
      .styled-checkbox:focus-visible,
      .close-btn:focus-visible {
        outline: 2px solid var(--primary-500);
        outline-offset: 2px;
      }
    </style>
  </head>
  <body>
    <!-- Navbar -->
    <div class="navbar">
      <div class="welcome">Bem-vindo(a), Administrador</div>
      <button class="Btn-logout logout-btn" onclick="logout()">
        <div class="sign">
          <svg viewBox="0 0 512 512">
            <path
              d="M377.9 105.9L500.7 228.7c7.2 7.2 11.3 17.1 11.3 27.3s-4.1 20.1-11.3 27.3L377.9 406.1c-6.4 6.4-15 9.9-24 9.9c-18.7 0-33.9-15.2-33.9-33.9l0-62.1-128 0c-17.7 0-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32l128 0 0-62.1c0-18.7 15.2-33.9 33.9-33.9c9 0 17.6 3.6 24 9.9zM160 96L96 96c-17.7 0-32 14.3-32 32l0 256c0 17.7 14.3 32 32 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32z"
            ></path>
          </svg>
        </div>
        <div class="text">Logout</div>
      </button>
    </div>

    <!-- Barra de Ações -->
    <div id="messages-header">
      <input
        type="text"
        id="searchBar"
        placeholder="Buscar mensagens..."
        onkeyup="searchMessages()"
      />
      <button id="selectMessagesBtn" class="btn btn-primary" onclick="toggleSelectMode()">
        Selecionar Mensagens
      </button>
      <button id="deleteSelectedBtn" class="btn btn-danger" onclick="openBulkDeleteModal()" disabled>
        Apagar
      </button>
    </div>

    <!-- Container de Mensagens -->
    <div id="messages-container">
      <h2>Mensagens Recebidas</h2>
      <div id="messages"></div>
    </div>

    <!-- Modal de Confirmação Individual -->
    <div id="deleteModal" class="modal">
      <div class="modal-content">
        <button class="close-btn" onclick="closeModal()">&times;</button>
        <div class="modal-header">
          <i class="icon-warning">⚠️</i>
          <h2>Excluir Mensagem</h2>
        </div>
        <p class="modal-body">
          Tem certeza de que deseja excluir esta mensagem? Esta ação não pode
          ser desfeita.
        </p>
        <div class="modal-footer">
          <button class="modal-button cancel-btn" onclick="closeModal()">
            Cancelar
          </button>
          <button class="modal-button confirm-btn" onclick="confirmDelete()">
            Sim, excluir
          </button>
        </div>
      </div>
    </div>

    <!-- Modal de Confirmação para Exclusão em Massa -->
    <div id="bulkDeleteModal" class="modal">
      <div class="modal-content">
        <button class="close-btn" onclick="closeBulkDeleteModal()">
          &times;
        </button>
        <div class="modal-header">
          <i class="icon-warning">⚠️</i>
          <h2>Excluir Mensagens Selecionadas</h2>
        </div>
        <p class="modal-body">
          Tem certeza de que deseja excluir as mensagens selecionadas? Esta ação
          não pode ser desfeita.
        </p>
        <div class="modal-footer">
          <button
            class="modal-button cancel-btn"
            onclick="closeBulkDeleteModal()"
          >
            Cancelar
          </button>
          <button
            class="modal-button confirm-btn"
            onclick="confirmBulkDelete()"
          >
            Sim, excluir
          </button>
        </div>
      </div>
    </div>

    <script>
      let messageIdToDelete = null;
      let selectedMessages = new Set();
      let isSelectMode = false;

      // Verifica a sessão do usuário antes de buscar as mensagens
      fetch("/check-session")
        .then((response) => response.json())
        .then((data) => {
          if (!data.authenticated) {
            window.location.href = "/login.html";
          } else {
            loadMessages();
          }
        });

      // Função para buscar e exibir as mensagens
      function loadMessages() {
        fetch("/messages")
          .then((response) => response.json())
          .then((data) => {
            const messagesDiv = document.getElementById("messages");
            messagesDiv.innerHTML = ""; // Limpa mensagens antigas
            data.forEach((msg) => {
              const messageElement = document.createElement("div");
              messageElement.className = "message";
              messageElement.innerHTML = `
                            <input type="checkbox" class="select-checkbox styled-checkbox" id="checkbox-${msg.id}" onclick="toggleSelect(${msg.id})">
                            <div class="message-title" style="text-align: center; margin-bottom: 10px; width: 95%;">
                              <span style="font-size: 1.2em; font-weight: bold;">${msg.titulo}</span>
                            </div>
                            <div class="message-content">
                                <p><strong>Nome:</strong> ${msg.nome}</p>
                                <p><strong>Email:</strong> ${msg.email}</p>
                                <p><strong>Mensagem:</strong></p>
                                <p>${msg.mensagem}</p>
                                <a href="mailto:${msg.email}">Responder</a>
                            </div>
                            <button class="delete-btn" onclick="openModal(${msg.id})">❌</button>
                        `;
              messagesDiv.appendChild(messageElement);
            });

            // Atualiza a visibilidade das checkboxes conforme o modo de seleção
            document
              .querySelectorAll(".select-checkbox")
              .forEach((checkbox) => {
                checkbox.style.display = isSelectMode ? "inline-block" : "none";
              });
          });
      }

      // Função para alternar o modo de seleção
      function toggleSelectMode() {
        isSelectMode = !isSelectMode;
        document
          .getElementById("messages-container")
          .classList.toggle("select-mode", isSelectMode);
        document.querySelectorAll(".select-checkbox").forEach((checkbox) => {
          checkbox.style.display = isSelectMode ? "inline-block" : "none";
          checkbox.checked = false; // Desmarca todas as caixas de seleção
        });
        selectedMessages.clear(); // Limpa mensagens selecionadas
        document.getElementById("deleteSelectedBtn").disabled = true; // Desativa o botão de apagar
      }

      // Função para alternar a seleção de mensagens
      function toggleSelect(messageId) {
        const checkbox = document.getElementById(`checkbox-${messageId}`);
        if (checkbox.checked) {
          selectedMessages.add(messageId);
        } else {
          selectedMessages.delete(messageId);
        }
        document.getElementById("deleteSelectedBtn").disabled =
          selectedMessages.size === 0;
      }

      // Função para buscar mensagens com base na pesquisa pelo nome
      function searchMessages() {
        const query = document.getElementById("searchBar").value.toLowerCase();
        document.querySelectorAll(".message").forEach((message) => {
          const nameElement = message.querySelector("p strong");
          if (nameElement) {
            const name = nameElement.nextSibling.textContent.toLowerCase();
            message.style.display = name.includes(query) ? "" : "none";
          }
        });
      }

      // Função para abrir o modal de exclusão em massa
      function openBulkDeleteModal() {
        if (selectedMessages.size > 0) {
          document.getElementById("bulkDeleteModal").style.display = "flex";
        }
      }

      // Função para fechar o modal de exclusão em massa
      function closeBulkDeleteModal() {
        document.getElementById("bulkDeleteModal").style.display = "none";
      }

      // Confirmação de exclusão em massa
      function confirmBulkDelete() {
        const promises = Array.from(selectedMessages).map((id) =>
          fetch(`/message/${id}`, { method: "DELETE" })
        );

        Promise.all(promises)
          .then(() => {
            loadMessages(); // Recarrega as mensagens após a exclusão
            closeBulkDeleteModal(); // Fecha o modal
            selectedMessages.clear(); // Limpa as mensagens selecionadas
            document.getElementById("deleteSelectedBtn").disabled = true; // Desativa o botão de apagar
            isSelectMode = false;
            toggleSelectMode(); // Sai do modo de seleção
          })
          .catch((error) => {
            console.error("Erro ao excluir mensagens:", error);
            alert("Ocorreu um erro ao excluir as mensagens. Tente novamente.");
          });
      }

      // Função para abrir o modal de confirmação de exclusão individual
      function openModal(id) {
        messageIdToDelete = id;
        document.getElementById("deleteModal").style.display = "flex";
      }

      // Função para fechar o modal
      function closeModal() {
        document.getElementById("deleteModal").style.display = "none";
        messageIdToDelete = null;
      }

      // Função para confirmar a exclusão individual
      function confirmDelete() {
        if (messageIdToDelete !== null) {
          fetch(`/message/${messageIdToDelete}`, { method: "DELETE" })
            .then((response) => {
              if (response.ok) {
                alert("Mensagem excluída com sucesso!");
                loadMessages(); // Recarrega as mensagens
                closeModal(); // Fecha o modal
              } else {
                throw new Error("Falha ao excluir a mensagem.");
              }
            })
            .catch((error) => {
              console.error("Erro ao excluir mensagem:", error);
              alert("Ocorreu um erro ao excluir a mensagem. Tente novamente.");
            });
        }
      }

      // Função para logout
      function logout() {
        fetch("/logout")
          .then((response) => {
            if (response.ok) {
              window.location.href = "/login.html";
            } else {
              throw new Error("Falha ao realizar logout.");
            }
          })
          .catch((error) => {
            console.error("Erro ao realizar logout:", error);
            alert("Ocorreu um erro ao realizar logout. Tente novamente.");
          });
      }

      // Fechar modais ao clicar fora do conteúdo
      window.onclick = function (event) {
        const deleteModal = document.getElementById("deleteModal");
        const bulkDeleteModal = document.getElementById("bulkDeleteModal");
        if (event.target == deleteModal) {
          closeModal();
        }
        if (event.target == bulkDeleteModal) {
          closeBulkDeleteModal();
        }
      };
    </script>
  </body>
</html>